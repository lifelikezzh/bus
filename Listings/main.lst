C51 COMPILER V9.60.7.0   MAIN                                                              11/29/2025 20:29:54 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.ls
                    -t) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Delay.h"
   3          #include "oled.h"
   4          #include "dht11.h"
   5          #include "ds1302.h"
   6          #include "xpt2046.h"
   7          unsigned char c=0;
   8          unsigned char ledon=0;
   9          unsigned char hour=12,min=0,sec=0;
  10          unsigned int adval=1;
  11          unsigned char interrupt1=0;
  12          unsigned char show10s=0;
  13          unsigned char bus1=57,bus2=40,bus3=99;
  14          unsigned char onesec=0;
  15          unsigned char uartcmd[6]={0};
  16          unsigned char uartindex=0;
  17          void timer0_init(){
  18   1              TMOD=0x01;
  19   1              TL0=0x00;
  20   1              TH0=0x4C;
  21   1              TF0=0;
  22   1              TR0=1;
  23   1              ET0=1;
  24   1              EA=1;
  25   1              PT0=0;
  26   1      }
  27          void UART_Init(){
  28   1              PCON&=0x7F;
  29   1              SCON=0x50;
  30   1              TMOD&=0x0F;
  31   1              TMOD|=0x20;
  32   1              TL1=0xFD;
  33   1              TH1=0xFD;
  34   1              ET1=0;
  35   1              TR1=1;
  36   1              ES=1;
  37   1      }
  38          void UART_SendByte(unsigned char Byte)
  39          {
  40   1              SBUF=Byte;
  41   1              while(TI==0);
  42   1              TI=0;
  43   1      }
  44          void UART_SendString(unsigned char *String)
  45          {
  46   1              unsigned char g=0;
  47   1              while(String[g]!=0){
  48   2                      UART_SendByte(String[g]);
  49   2                      g++;
  50   2              }
  51   1      }
  52          int main(){
  53   1              OLED_Init();OLED_ColorTurn(0);OLED_DisplayTurn(0);
  54   1              DHT11_Init();DHT11_GetData();
C51 COMPILER V9.60.7.0   MAIN                                                              11/29/2025 20:29:54 PAGE 2   

  55   1              adval=XPT2046_Read(0xAC);
  56   1              OLED_ShowString(0,3,"Temperature:",8);
  57   1              OLED_ShowString(0,4,"Humidity:",8);
  58   1              OLED_ShowString(0,5,"Time:",8);
  59   1              OLED_ShowString(0,6,"Light:",8);
  60   1              OLED_ShowString(44,5,":",8);
  61   1              OLED_ShowString(60,5,":",8);
  62   1              OLED_ShowString(0,0,"bus 1:",8);
  63   1              OLED_ShowString(64,0,"min",8);
  64   1              OLED_ShowString(0,1,"bus 2:",8);
  65   1              OLED_ShowString(64,1,"min",8);
  66   1              OLED_ShowString(0,2,"bus 3:",8);
  67   1              OLED_ShowString(64,2,"min",8);
  68   1              OLED_ShowNum(32,5,hour/16*10+hour%16,2,8);
  69   1              OLED_ShowNum(48,5,min/16*10+min%16,2,8);
  70   1              OLED_ShowNum(64,5,sec/16*10+sec%16,2,8);
  71   1              OLED_ShowNum(40,6,adval,3,8);
  72   1              OLED_ShowNum(72,3,temp_int,2,8);
  73   1              OLED_ShowNum(72,4,hum_int,2,8);
  74   1              timer0_init();
  75   1              DS1302_Init();
  76   1              hour=DS1302_Read(0x85);min=DS1302_Read(0x83);sec=DS1302_Read(0x81);
  77   1              UART_Init();
  78   1              while(1){
  79   2                      if(onesec==1){
  80   3                              onesec=0;
  81   3                              bus1--;bus2--;bus3--;
  82   3                              OLED_ShowNum(40,0,bus1,2,8);
  83   3                              OLED_ShowNum(40,1,bus2,2,8);
  84   3                              OLED_ShowNum(40,2,bus3,2,8);
  85   3                              hour=DS1302_Read(0x85);
  86   3                              min=DS1302_Read(0x83);
  87   3                              sec=DS1302_Read(0x81);
  88   3                              adval=XPT2046_Read(0xAC);
  89   3                              DHT11_Init();
  90   3                              DHT11_GetData();
  91   3                              OLED_ShowNum(32,5,hour/16*10+hour%16,2,8);
  92   3                              OLED_ShowNum(48,5,min/16*10+min%16,2,8);
  93   3                              OLED_ShowNum(64,5,sec/16*10+sec%16,2,8);
  94   3                              if(show10s>=10){
  95   4                                      show10s=0;
  96   4                                      OLED_ShowNum(40,6,adval,3,8);
  97   4                                      OLED_ShowNum(72,3,temp_int,2,8);
  98   4                                      OLED_ShowNum(72,4,hum_int,2,8);
  99   4                              }
 100   3                      }
 101   2              }
 102   1      }
 103          void timer0_interrupt()interrupt 1
 104          {
 105   1              interrupt1++;
 106   1              TL0=0x00;TH0=0x4C;
 107   1              if(interrupt1>=20){
 108   2                      interrupt1=0;show10s++;onesec=1;
 109   2              }
 110   1      }
 111          void uart_interrupt()interrupt 4
 112          {
 113   1              if(RI==1){
 114   2                      unsigned char rec;
 115   2                      RI=0;
 116   2                      rec=SBUF;
C51 COMPILER V9.60.7.0   MAIN                                                              11/29/2025 20:29:54 PAGE 3   

 117   2                      if(rec!='\n'){uartcmd[uartindex]=rec;uartindex++;}
 118   2                      else{
 119   3                              if(uartcmd[0]=='Q' && uartcmd[1]==0){
 120   4                                      UART_SendString("bus1: ");
 121   4                                      UART_SendByte(bus1/10+'0');
 122   4                                      UART_SendByte(bus1%10+'0');
 123   4                                      UART_SendString("min\n");
 124   4                                      UART_SendString("bus2: ");
 125   4                                      UART_SendByte(bus2/10+'0');
 126   4                                      UART_SendByte(bus2%10+'0');
 127   4                                      UART_SendString("min\n");
 128   4                                      UART_SendString("bus3: ");
 129   4                                      UART_SendByte(bus3/10+'0');
 130   4                                      UART_SendByte(bus3%10+'0');
 131   4                                      UART_SendString("min\n");
 132   4                              }
 133   3                              else if(uartcmd[0]=='S'){
 134   4                                      unsigned char which=uartcmd[1]-'0';
 135   4                                      switch(which){
 136   5                                              case 1:
 137   5                                                      bus1=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 138   5                                                      break;
 139   5                                              case 2:
 140   5                                                      bus2=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 141   5                                                      break;
 142   5                                              case 3:
 143   5                                                      bus3=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 144   5                                                      break;
 145   5                                              default:
 146   5                                                      UART_SendString("error");
 147   5                                                      break;
 148   5                                      }
 149   4                              }
 150   3                              uartindex=0;uartcmd[0]=0;uartcmd[1]=0;uartcmd[2]=0;uartcmd[3]=0;uartcmd[4]=0;uartcmd[5]=0;
 151   3                      }
 152   2              }
 153   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1115    ----
   CONSTANT SIZE    =     95    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
