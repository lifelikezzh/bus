C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/18/2025 22:39:31 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE INTERRUPT
OBJECT MODULE PLACED IN .\Objects\interrupt.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE interrupt.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\in
                    -terrupt.lst) OBJECT(.\Objects\interrupt.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <interrupt.h>
   3          extern volatile unsigned char busindex;
   4          extern volatile unsigned char onesec;
   5          extern volatile unsigned char show10s;
   6          extern volatile unsigned char timer0Index;
   7          extern volatile unsigned char uartcmd[6];
   8          extern volatile unsigned char uartindex;
   9          extern volatile unsigned int bus1,bus2,bus3;
  10          volatile unsigned char pwmCount=0,pwmDuty=0;
  11          extern volatile unsigned char ledon;
  12          volatile unsigned char sendHelp=0,readCmd=0;
  13          extern volatile unsigned char bus1near,bus2near,bus3near;
  14          void timer0_init(){
  15   1              TMOD&=0xF0;
  16   1              TMOD|=0x01;
  17   1              TL0=0x00;
  18   1              TH0=0x4C;
  19   1              TF0=0;
  20   1              TR0=1;
  21   1              ET0=1;
  22   1              EA=1;
  23   1              PT0=0;
  24   1      }
  25          void timer2_init() {
  26   1          RCAP2H=0xFF;
  27   1          RCAP2L=0x9C;
  28   1          TH2=0xFF;
  29   1          TL2=0x9C;
  30   1          T2CON=0;
  31   1          ET2=1;
  32   1          TR2=1;
  33   1          EA=1;
  34   1      }
  35          void UART_Init(){
  36   1              PCON&=0x7F;
  37   1              SCON=0x50;
  38   1              TMOD&=0x0F;
  39   1              TMOD|=0x20;
  40   1              TL1=0xFD;
  41   1              TH1=0xFD;
  42   1              ET1=0;
  43   1              TR1=1;
  44   1              ES=1;
  45   1      }
  46          
  47          void Ext_Init(){
  48   1              IT0=1;
  49   1              EX0=1;
  50   1              IT1=1;
  51   1              EX1=1;
  52   1      }
  53          void UART_SendByte(unsigned char Byte){
  54   1              ES=0;
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/18/2025 22:39:31 PAGE 2   

  55   1              SBUF=Byte;
  56   1              while(TI==0);
  57   1              TI=0;
  58   1              ES=1;
  59   1      }
  60          void UART_SendString(unsigned char *String){
  61   1              unsigned char g=0;
  62   1              while(String[g]!=0){
  63   2                      UART_SendByte(String[g]);
  64   2                      g++;
  65   2              }
  66   1      }
  67          void timer0_interrupt()interrupt 1
  68          {
  69   1              timer0Index++;
  70   1              TL0=0x00;TH0=0x4C;
  71   1              if(timer0Index>=20){
  72   2                      timer0Index=0;show10s++;onesec=1;
  73   2              }
  74   1      }
  75          void timer2_interrupt() interrupt 5
  76          {
  77   1          TF2=0;
  78   1          pwmCount++;
  79   1          if(pwmCount>=100){pwmCount=0;}
  80   1          if(pwmCount<pwmDuty && ledon==1){P2=0x00;}
  81   1              else{P2=0xFF;}
  82   1      }
  83          void INT1_Isr() interrupt 2
  84          {
  85   1              sendHelp=1;
  86   1              P1_5=0;
  87   1      }
  88          void INT0_Isr() interrupt 0
  89          {
  90   1              EX0=0;
  91   1              busindex++;
  92   1              if(busindex>=4){busindex=0;}
  93   1      }
  94          void uart_interrupt()interrupt 4
  95          {
  96   1              if(RI==1){
  97   2                      unsigned char rec;
  98   2                      RI=0;
  99   2                      rec=SBUF;
 100   2                      if(rec!='\n'){uartcmd[uartindex]=rec;uartindex++;}
 101   2                      else{
 102   3                              readCmd=1;
 103   3                      }
 104   2              }
 105   1      }
 106          void UART_main()
 107          {
 108   1              if(bus1near==1 || bus2near==1 || bus3near==1){
 109   2                      if(bus1near==1){
 110   3                              bus1near=0;UART_SendString("bus1 is approaching\n");
 111   3                      }
 112   2                      if(bus2near==1){
 113   3                              bus2near=0;UART_SendString("bus2 is approaching\n");
 114   3                      }
 115   2                      if(bus3near==1){
 116   3                              bus3near=0;UART_SendString("bus3 is approaching\n");
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/18/2025 22:39:31 PAGE 3   

 117   3                      }
 118   2              }
 119   1              if(sendHelp==1){
 120   2                      UART_SendString("HELP\n");
 121   2                      sendHelp=0;
 122   2              }
 123   1              if(readCmd==1){
 124   2                      if(uartcmd[0]=='Q' && uartcmd[1]==0){
 125   3                              UART_SendString("bus1: ");
 126   3                              UART_SendByte(bus1/60/10+'0');
 127   3                              UART_SendByte(bus1/60%10+'0');
 128   3                              UART_SendString(":");
 129   3                              UART_SendByte(bus1%60/10+'0');
 130   3                              UART_SendByte(bus1%60%10+'0');
 131   3                              UART_SendString("\n");
 132   3                              UART_SendString("bus2: ");
 133   3                              UART_SendByte(bus2/60/10+'0');
 134   3                              UART_SendByte(bus2/60%10+'0');
 135   3                              UART_SendString(":");
 136   3                              UART_SendByte(bus2%60/10+'0');
 137   3                              UART_SendByte(bus2%60%10+'0');
 138   3                              UART_SendString("\n");
 139   3                              UART_SendString("bus3: ");
 140   3                              UART_SendByte(bus3/60/10+'0');
 141   3                              UART_SendByte(bus3/60%10+'0');
 142   3                              UART_SendString(":");
 143   3                              UART_SendByte(bus3%60/10+'0');
 144   3                              UART_SendByte(bus3%60%10+'0');
 145   3                              UART_SendString("\n");
 146   3                      }
 147   2                      else if(uartcmd[0]=='S'){
 148   3                              unsigned char which=uartcmd[1]-'0';
 149   3                              switch(which){
 150   4                                      case 1:
 151   4                                              bus1=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 152   4                                              break;
 153   4                                      case 2:
 154   4                                              bus2=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 155   4                                              break;
 156   4                                      case 3:
 157   4                                              bus3=(uartcmd[2]-'0')*100+(uartcmd[3]-'0')*10+uartcmd[4]-'0';
 158   4                                              break;
 159   4                                      default:
 160   4                                              UART_SendString("error\n");
 161   4                                              break;
 162   4                              }
 163   3                      }
 164   2                      uartindex=0;
 165   2                      uartcmd[0]=0;uartcmd[1]=0;uartcmd[2]=0;uartcmd[3]=0;uartcmd[4]=0;uartcmd[5]=0;
 166   2                      readCmd=0;
 167   2              }
 168   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    928    ----
   CONSTANT SIZE    =    101    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.7.0   INTERRUPT                                                         12/18/2025 22:39:31 PAGE 4   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
